{
    "sourceFile": "backend/controllers/orderController.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 15,
            "patches": [
                {
                    "date": 1769589248305,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1769589346961,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -106,8 +106,9 @@\n \r\n // verfiy payment and update order status\r\n const verifyStripePayment = async (req, res) => {\r\n     try {\r\n+        console.log(req.body);\r\n         const { orderId, success } = req.body;\r\n         const userId = req.userId; \r\n         if (success == 'true' || success === true) {\r\n             await orderModel.findByIdAndUpdate(orderId, { status: 'Confirmed', payment: true });\r\n@@ -119,9 +120,8 @@\n     }\r\n } catch (error) {\r\n         console.log(error);\r\n         res.json({ success: false, message: error.message });\r\n-        \r\n     }\r\n }\r\n \r\n // placing orders using Razorpay\r\n"
                },
                {
                    "date": 1769589357540,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -106,9 +106,9 @@\n \r\n // verfiy payment and update order status\r\n const verifyStripePayment = async (req, res) => {\r\n     try {\r\n-        console.log(req.body);\r\n+        console.log(\"strip\"+req.body);\r\n         const { orderId, success } = req.body;\r\n         const userId = req.userId; \r\n         if (success == 'true' || success === true) {\r\n             await orderModel.findByIdAndUpdate(orderId, { status: 'Confirmed', payment: true });\r\n"
                },
                {
                    "date": 1769589465908,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -106,9 +106,9 @@\n \r\n // verfiy payment and update order status\r\n const verifyStripePayment = async (req, res) => {\r\n     try {\r\n-        console.log(\"strip\"+req.body);\r\n+        console.log(\"strip\" , req.body);\r\n         const { orderId, success } = req.body;\r\n         const userId = req.userId; \r\n         if (success == 'true' || success === true) {\r\n             await orderModel.findByIdAndUpdate(orderId, { status: 'Confirmed', payment: true });\r\n"
                },
                {
                    "date": 1769589569554,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -48,8 +48,9 @@\n \r\n // placing orders using Stipe method\r\n const placeOrderStripe = async (req, res) => {\r\n     try {\r\n+         console.log(\"strip\" , req.body);\r\n          const { items, amount, address } = req.body;\r\n          const userId = req.userId; // from auth middleware\r\n \r\n          const {origin} = req.headers;\r\n@@ -106,9 +107,9 @@\n \r\n // verfiy payment and update order status\r\n const verifyStripePayment = async (req, res) => {\r\n     try {\r\n-        console.log(\"strip\" , req.body);\r\n+       \r\n         const { orderId, success } = req.body;\r\n         const userId = req.userId; \r\n         if (success == 'true' || success === true) {\r\n             await orderModel.findByIdAndUpdate(orderId, { status: 'Confirmed', payment: true });\r\n"
                },
                {
                    "date": 1769590068568,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -48,9 +48,9 @@\n \r\n // placing orders using Stipe method\r\n const placeOrderStripe = async (req, res) => {\r\n     try {\r\n-         console.log(\"strip\" , req.body);\r\n+         console.log(\"strip\" , req.query);\r\n          const { items, amount, address } = req.body;\r\n          const userId = req.userId; // from auth middleware\r\n \r\n          const {origin} = req.headers;\r\n"
                },
                {
                    "date": 1769590269846,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -48,10 +48,10 @@\n \r\n // placing orders using Stipe method\r\n const placeOrderStripe = async (req, res) => {\r\n     try {\r\n-         console.log(\"strip\" , req.query);\r\n          const { items, amount, address } = req.body;\r\n+         console.log(items, amount, address)\r\n          const userId = req.userId; // from auth middleware\r\n \r\n          const {origin} = req.headers;\r\n \r\n"
                },
                {
                    "date": 1769590298935,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -49,9 +49,9 @@\n // placing orders using Stipe method\r\n const placeOrderStripe = async (req, res) => {\r\n     try {\r\n          const { items, amount, address } = req.body;\r\n-         console.log(items, amount, address)\r\n+         console.log(\"strip\",items, amount, address);\r\n          const userId = req.userId; // from auth middleware\r\n \r\n          const {origin} = req.headers;\r\n \r\n"
                },
                {
                    "date": 1769590492253,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -48,10 +48,10 @@\n \r\n // placing orders using Stipe method\r\n const placeOrderStripe = async (req, res) => {\r\n     try {\r\n+         console.log(\"strip\" , req.query);\r\n          const { items, amount, address } = req.body;\r\n-         console.log(\"strip\",items, amount, address);\r\n          const userId = req.userId; // from auth middleware\r\n \r\n          const {origin} = req.headers;\r\n \r\n"
                },
                {
                    "date": 1769590578636,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -48,9 +48,9 @@\n \r\n // placing orders using Stipe method\r\n const placeOrderStripe = async (req, res) => {\r\n     try {\r\n-         console.log(\"strip\" , req.query);\r\n+         console.log(\"strip\" , req.body);\r\n          const { items, amount, address } = req.body;\r\n          const userId = req.userId; // from auth middleware\r\n \r\n          const {origin} = req.headers;\r\n"
                },
                {
                    "date": 1769590647288,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -48,9 +48,9 @@\n \r\n // placing orders using Stipe method\r\n const placeOrderStripe = async (req, res) => {\r\n     try {\r\n-         console.log(\"strip\" , req.body);\r\n+         \r\n          const { items, amount, address } = req.body;\r\n          const userId = req.userId; // from auth middleware\r\n \r\n          const {origin} = req.headers;\r\n"
                },
                {
                    "date": 1769591130619,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -48,9 +48,8 @@\n \r\n // placing orders using Stipe method\r\n const placeOrderStripe = async (req, res) => {\r\n     try {\r\n-         \r\n          const { items, amount, address } = req.body;\r\n          const userId = req.userId; // from auth middleware\r\n \r\n          const {origin} = req.headers;\r\n"
                },
                {
                    "date": 1769591787470,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,9 @@\n \r\n import Stripe from \"stripe\";\r\n \r\n // global variable for\r\n-const currency = \"INR\";\r\n+const currency = \"IN\";\r\n const deliveryCharge = 49;\r\n \r\n // gateway for\r\n const stripe = new Stripe(process.env.STRIPE_SECRET_KEY);\r\n@@ -53,9 +53,9 @@\n          const userId = req.userId; // from auth middleware\r\n \r\n          const {origin} = req.headers;\r\n \r\n-        //  order data\r\n+  \r\n          // create new order document\r\n         const newOrder = new orderModel({\r\n             userId,\r\n             items,\r\n@@ -89,8 +89,9 @@\n                 },\r\n                 quantity: 1,\r\n             });\r\n \r\n+            //This creates a temporary payment session on Stripe\r\n             const session = await stripe.checkout.sessions.create({\r\n                 success_url: `${origin}/verify?success=true&orderId=${newOrder._id}`,\r\n                 cancel_url: `${origin}/verify?canceled=true&orderId=${newOrder._id}`,\r\n                 line_items,\r\n"
                },
                {
                    "date": 1769591827651,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,9 @@\n \r\n import Stripe from \"stripe\";\r\n \r\n // global variable for\r\n-const currency = \"IN\";\r\n+const currency = \"INR\";\r\n const deliveryCharge = 49;\r\n \r\n // gateway for\r\n const stripe = new Stripe(process.env.STRIPE_SECRET_KEY);\r\n"
                },
                {
                    "date": 1769592154222,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -67,9 +67,9 @@\n \r\n          await newOrder.save();\r\n \r\n         // create stripe session\r\n-            const line_items = items.map((item) => ({\r\n+            const line_item = items.map((item) => ({\r\n                 price_data: {\r\n                     currency: currency,\r\n                     product_data: {\r\n                         name: item.name,\r\n@@ -78,9 +78,9 @@\n                 },\r\n                 quantity: item.quantity,\r\n             }));\r\n             // adding delivery charges as a separate item\r\n-            line_items.push({\r\n+            line_item.push({\r\n                 price_data: {\r\n                     currency: currency,\r\n                     product_data: {\r\n                         name: \"Delivery Charges\",\r\n@@ -93,9 +93,9 @@\n             //This creates a temporary payment session on Stripe\r\n             const session = await stripe.checkout.sessions.create({\r\n                 success_url: `${origin}/verify?success=true&orderId=${newOrder._id}`,\r\n                 cancel_url: `${origin}/verify?canceled=true&orderId=${newOrder._id}`,\r\n-                line_items,\r\n+                line_item,\r\n                 mode: 'payment',\r\n             });\r\n             res.json({ success: true, url: session.url });\r\n     } catch (error) {\r\n"
                },
                {
                    "date": 1769592185380,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -67,9 +67,9 @@\n \r\n          await newOrder.save();\r\n \r\n         // create stripe session\r\n-            const line_item = items.map((item) => ({\r\n+            const line_items = items.map((item) => ({\r\n                 price_data: {\r\n                     currency: currency,\r\n                     product_data: {\r\n                         name: item.name,\r\n@@ -78,9 +78,9 @@\n                 },\r\n                 quantity: item.quantity,\r\n             }));\r\n             // adding delivery charges as a separate item\r\n-            line_item.push({\r\n+            line_items.push({\r\n                 price_data: {\r\n                     currency: currency,\r\n                     product_data: {\r\n                         name: \"Delivery Charges\",\r\n@@ -93,9 +93,9 @@\n             //This creates a temporary payment session on Stripe\r\n             const session = await stripe.checkout.sessions.create({\r\n                 success_url: `${origin}/verify?success=true&orderId=${newOrder._id}`,\r\n                 cancel_url: `${origin}/verify?canceled=true&orderId=${newOrder._id}`,\r\n-                line_item,\r\n+                line_items,\r\n                 mode: 'payment',\r\n             });\r\n             res.json({ success: true, url: session.url });\r\n     } catch (error) {\r\n"
                }
            ],
            "date": 1769589248305,
            "name": "Commit-0",
            "content": "import orderModel from \"../models/orderModel.js\";\r\nimport userModel from \"../models/userModel.js\";\r\n\r\nimport Stripe from \"stripe\";\r\n\r\n// global variable for\r\nconst currency = \"INR\";\r\nconst deliveryCharge = 49;\r\n\r\n// gateway for\r\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY);\r\n\r\n// placing orders using COD method\r\nconst placeOrderCOD = async (req, res) => {\r\n    try {\r\n        const { items, amount, address } = req.body;\r\n        const userId = req.userId; // from auth middleware\r\n\r\n        if (!userId) {\r\n            return res.status(401).json({ success: false, message: 'Unauthorized' });\r\n        }\r\n\r\n        if (!Array.isArray(items) || items.length === 0) {\r\n            return res.status(400).json({ success: false, message: 'No items in order' });\r\n        }\r\n\r\n        // create new order document\r\n        const newOrder = new orderModel({\r\n            userId,\r\n            items,\r\n            address,\r\n            amount,\r\n            PaymentMethod: \"COD\",\r\n            status: 'Pending',\r\n            payment: false,\r\n        });\r\n\r\n        await newOrder.save();\r\n        await userModel.findByIdAndUpdate(userId, { cartData: {} });\r\n        res.json({ success: true, message: \"Order placed successfully\", orderId: newOrder._id });\r\n\r\n    } catch (error) {\r\n        console.log(error);\r\n        res.json({ success: false, message: error.message });\r\n    }\r\n};\r\n\r\n\r\n// placing orders using Stipe method\r\nconst placeOrderStripe = async (req, res) => {\r\n    try {\r\n         const { items, amount, address } = req.body;\r\n         const userId = req.userId; // from auth middleware\r\n\r\n         const {origin} = req.headers;\r\n\r\n        //  order data\r\n         // create new order document\r\n        const newOrder = new orderModel({\r\n            userId,\r\n            items,\r\n            address,\r\n            amount,\r\n            PaymentMethod: \"Stripe\", \r\n            payment: false,\r\n        });\r\n\r\n         await newOrder.save();\r\n\r\n        // create stripe session\r\n            const line_items = items.map((item) => ({\r\n                price_data: {\r\n                    currency: currency,\r\n                    product_data: {\r\n                        name: item.name,\r\n                    },\r\n                    unit_amount: item.price * 100,\r\n                },\r\n                quantity: item.quantity,\r\n            }));\r\n            // adding delivery charges as a separate item\r\n            line_items.push({\r\n                price_data: {\r\n                    currency: currency,\r\n                    product_data: {\r\n                        name: \"Delivery Charges\",\r\n                    },\r\n                    unit_amount: deliveryCharge * 100,\r\n                },\r\n                quantity: 1,\r\n            });\r\n\r\n            const session = await stripe.checkout.sessions.create({\r\n                success_url: `${origin}/verify?success=true&orderId=${newOrder._id}`,\r\n                cancel_url: `${origin}/verify?canceled=true&orderId=${newOrder._id}`,\r\n                line_items,\r\n                mode: 'payment',\r\n            });\r\n            res.json({ success: true, url: session.url });\r\n    } catch (error) {\r\n        console.log(error);\r\n        res.json({ success: false, message: error.message });\r\n        \r\n    }\r\n};\r\n\r\n// verfiy payment and update order status\r\nconst verifyStripePayment = async (req, res) => {\r\n    try {\r\n        const { orderId, success } = req.body;\r\n        const userId = req.userId; \r\n        if (success == 'true' || success === true) {\r\n            await orderModel.findByIdAndUpdate(orderId, { status: 'Confirmed', payment: true });\r\n            await userModel.findByIdAndUpdate(userId, { cartData: {} });\r\n            res.json({ success: true, message: 'Payment verified and order confirmed' });\r\n    } else {\r\n        await orderModel.findByIdAndDelete(orderId, { status: 'Cancelled', payment: false });\r\n        res.json({ success: false, message: 'Payment failed or cancelled' });\r\n    }\r\n} catch (error) {\r\n        console.log(error);\r\n        res.json({ success: false, message: error.message });\r\n        \r\n    }\r\n}\r\n\r\n// placing orders using Razorpay\r\nconst placeOrderRazorpay = async (req, res) => {};\r\n\r\n// all orders of admin panel\r\nconst getAllOrders = async (req, res) => {\r\n    try {\r\n        const orders = await orderModel.find({});\r\n        res.json({ success: true, orders });\r\n    } catch (error) {\r\n        console.log(error);\r\n        res.json({ success: false, message: error.message });\r\n    }\r\n};\r\n\r\n// update order status by admin planel\r\nconst updateOrderStatus = async (req, res) => {\r\n    try{\r\n        const { orderId, status } = req.body;\r\n        await orderModel.findByIdAndUpdate(orderId, { status });\r\n        res.json({ success: true, message: \"Order status updated successfully\" });\r\n    }\r\n    catch(error){\r\n        console.log(error);\r\n        res.json({ success: false, message: error.message });\r\n    }                        \r\n}\r\n\r\n// user orders data for frontend\r\nconst getUserOrders = async (req, res) => {\r\n   try {\r\n     const userId = req.userId; // from auth middleware\r\n     \r\n     if (!userId) {\r\n       return res.status(401).json({ success: false, message: 'Unauthorized' });\r\n     }\r\n     \r\n     const orders = await orderModel.find({userId});\r\n     res.json({success:true, orders});\r\n\r\n   } catch (error) {\r\n        console.log(error);\r\n        res.json({ success: false, message: error.message });\r\n   }\r\n};\r\n\r\n\r\n\r\nexport {\r\n    placeOrderCOD,\r\n    placeOrderStripe,   \r\n    placeOrderRazorpay,\r\n    getAllOrders,\r\n    getUserOrders,\r\n    updateOrderStatus,\r\n    verifyStripePayment\r\n};"
        }
    ]
}