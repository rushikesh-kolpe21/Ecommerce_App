{
    "sourceFile": "frontend/src/context/ShopContext.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1769486771402,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1769487909525,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -182,8 +182,9 @@\n     \r\n   };\r\n \r\n   return (\r\n+    \r\n     // provide context to children components\r\n     <ShopContext.Provider value={value}>{props.children}</ShopContext.Provider>\r\n   );\r\n };\n\\ No newline at end of file\n"
                },
                {
                    "date": 1769488925659,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,8 +16,9 @@\n   const [cartItems, setCartItems] = useState({});\r\n   const [products, setProducts] = useState([]);\r\n   const [token, setToken] = useState(\"\");\r\n   const [loading, setLoading] = useState(true);\r\n+  \r\n   const navigate = useNavigate();\r\n \r\n   const addToCart = async (itemId, size) => {\r\n     if (!size) {\r\n@@ -182,9 +183,9 @@\n     \r\n   };\r\n \r\n   return (\r\n-    \r\n+\r\n     // provide context to children components\r\n     <ShopContext.Provider value={value}>{props.children}</ShopContext.Provider>\r\n   );\r\n };\n\\ No newline at end of file\n"
                },
                {
                    "date": 1769494102650,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,26 +16,33 @@\n   const [cartItems, setCartItems] = useState({});\r\n   const [products, setProducts] = useState([]);\r\n   const [token, setToken] = useState(\"\");\r\n   const [loading, setLoading] = useState(true);\r\n-  \r\n+\r\n   const navigate = useNavigate();\r\n \r\n+  //\r\n+\r\n   const addToCart = async (itemId, size) => {\r\n     if (!size) {\r\n       toast.error(\"Please select a size\");\r\n       return;\r\n     }\r\n \r\n+    // deep clone cartItems to avoid direct state mutation\r\n     let cartData = structuredClone(cartItems);\r\n \r\n+    // add item to cart logic\r\n     if (cartData[itemId]) {\r\n+      // item already in cart\r\n       if (cartData[itemId][size]) {\r\n         cartData[itemId][size] += 1;\r\n       } else {\r\n+        // size not present for this item\r\n         cartData[itemId][size] = 1;\r\n       }\r\n     } else {\r\n+      // item not in cart\r\n       cartData[itemId] = {};\r\n       cartData[itemId][size] = 1;\r\n     }\r\n     setCartItems(cartData);\r\n@@ -53,13 +60,16 @@\n       }\r\n     }\r\n   };\r\n \r\n+\r\n+  // cart bag count\r\n+  //\r\n   const getCartCount = () => {\r\n     let totalCount = 0;\r\n     for (const itemId in cartItems) {\r\n       for (const size in cartItems[itemId]) {\r\n-        totalCount += cartItems[itemId][size];\r\n+        totalCount = totalCount + cartItems[itemId][size];\r\n       }\r\n     }\r\n     return totalCount;\r\n   };\r\n"
                },
                {
                    "date": 1769494847953,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -73,8 +73,10 @@\n     }\r\n     return totalCount;\r\n   };\r\n \r\n+\r\n+  //\r\n   const updateQuantity = async (itemId, size, quantity) => {\r\n     let cartData = structuredClone(cartItems);\r\n     cartData[itemId][size] = quantity;\r\n     setCartItems(cartData);\r\n@@ -92,8 +94,9 @@\n       }\r\n     }\r\n   };\r\n \r\n+  // total amount\r\n   const getTotalAmount = () => {\r\n     let totalAmount = 0;\r\n     for (const itemId in cartItems) {\r\n       const productData = products.find((prod) => prod._id === itemId);\r\n@@ -104,8 +107,9 @@\n     }\r\n     return totalAmount;\r\n   };\r\n \r\n+  // fetch products data from backend api\r\n   const getProductsData = async () => {\r\n     try {\r\n       setLoading(true);\r\n       if (!backendUrl) {\r\n@@ -128,8 +132,9 @@\n       setLoading(false);\r\n     }\r\n   };\r\n \r\n+  // fetch cart data from backend api\r\n   const getUserCart = async (authToken) => {\r\n     try {\r\n       const tokenToUse = authToken || token;\r\n       console.log(\"Getting cart with token:\", tokenToUse ? \"Token exists\" : \"No token\");\r\n@@ -170,8 +175,9 @@\n       getUserCart(token);\r\n     }\r\n   }, [token, backendUrl]);\r\n \r\n+  \r\n   const value = {\r\n     products,\r\n     currency,\r\n     delivery_fee,\r\n"
                }
            ],
            "date": 1769486771402,
            "name": "Commit-0",
            "content": "import { createContext, useEffect, useState } from \"react\";\r\nimport { toast } from \"react-toastify\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\n// create context \r\nexport const ShopContext = createContext();\r\n\r\n// context provider\r\nexport const ShopContextProvider = (props) => {\r\n  const currency = \"$\";\r\n  const delivery_fee = 10;\r\n  const backendUrl = import.meta.env.VITE_BACKEND_URL;\r\n  const [search, setSearch] = useState(\"\");\r\n  const [showSearch, setShowSearch] = useState(false);\r\n  const [cartItems, setCartItems] = useState({});\r\n  const [products, setProducts] = useState([]);\r\n  const [token, setToken] = useState(\"\");\r\n  const [loading, setLoading] = useState(true);\r\n  const navigate = useNavigate();\r\n\r\n  const addToCart = async (itemId, size) => {\r\n    if (!size) {\r\n      toast.error(\"Please select a size\");\r\n      return;\r\n    }\r\n\r\n    let cartData = structuredClone(cartItems);\r\n\r\n    if (cartData[itemId]) {\r\n      if (cartData[itemId][size]) {\r\n        cartData[itemId][size] += 1;\r\n      } else {\r\n        cartData[itemId][size] = 1;\r\n      }\r\n    } else {\r\n      cartData[itemId] = {};\r\n      cartData[itemId][size] = 1;\r\n    }\r\n    setCartItems(cartData);\r\n\r\n    if (token) {\r\n      try {\r\n        await axios.post(\r\n          backendUrl + \"/api/cart/add\",\r\n          { itemId, size, quantity: 1 },\r\n          { headers: { authorization: token } }\r\n        );\r\n      } catch (error) {\r\n        console.error(\"Error adding to cart:\", error);\r\n        toast.error(error.response?.data?.message || error.message);\r\n      }\r\n    }\r\n  };\r\n\r\n  const getCartCount = () => {\r\n    let totalCount = 0;\r\n    for (const itemId in cartItems) {\r\n      for (const size in cartItems[itemId]) {\r\n        totalCount += cartItems[itemId][size];\r\n      }\r\n    }\r\n    return totalCount;\r\n  };\r\n\r\n  const updateQuantity = async (itemId, size, quantity) => {\r\n    let cartData = structuredClone(cartItems);\r\n    cartData[itemId][size] = quantity;\r\n    setCartItems(cartData);\r\n\r\n    if (token) {\r\n      try {\r\n        await axios.post(\r\n          backendUrl + \"/api/cart/update\",\r\n          { itemId, size, quantity },\r\n          { headers: { authorization: token } }\r\n        );\r\n      } catch (error) {\r\n        console.error(\"Error updating cart:\", error);\r\n        toast.error(error.response?.data?.message || error.message);\r\n      }\r\n    }\r\n  };\r\n\r\n  const getTotalAmount = () => {\r\n    let totalAmount = 0;\r\n    for (const itemId in cartItems) {\r\n      const productData = products.find((prod) => prod._id === itemId);\r\n      if (!productData) continue;\r\n      for (const size in cartItems[itemId]) {\r\n        totalAmount += productData.price * cartItems[itemId][size];\r\n      }\r\n    }\r\n    return totalAmount;\r\n  };\r\n\r\n  const getProductsData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      if (!backendUrl) {\r\n        console.warn(\"Backend URL is not configured\");\r\n        setLoading(false);\r\n        return;\r\n      }\r\n      const response = await axios.get(`${backendUrl}/api/products/list`);\r\n      if (response.data?.success) {\r\n        setProducts(response.data.productsList || []);\r\n        console.log(\"Products loaded successfully:\", response.data.productsList);\r\n      } else {\r\n        console.error(\"Failed to fetch products :\", response.data?.message);\r\n        toast.error(response.data?.message || \"Failed to fetch products data\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching products data:\", error);\r\n      toast.error(error?.response?.data?.message || \"Failed to fetch products data\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const getUserCart = async (authToken) => {\r\n    try {\r\n      const tokenToUse = authToken || token;\r\n      console.log(\"Getting cart with token:\", tokenToUse ? \"Token exists\" : \"No token\");\r\n      \r\n      if (!tokenToUse) {\r\n        console.log(\"No token available, skipping cart fetch\");\r\n        return;\r\n      }\r\n    \r\n      const response = await axios.get(backendUrl + \"/api/cart/get\", {\r\n        headers: { authorization: tokenToUse },\r\n      });\r\n      if (response.data.success) {\r\n        setCartItems(response.data.cartData);\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n      toast.error(error?.response?.data?.message || \"Failed to fetch cart data\");\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (backendUrl) {\r\n      getProductsData();\r\n    }\r\n  }, [backendUrl]);\r\n\r\n  useEffect(() => {\r\n    const localToken = localStorage.getItem(\"token\");\r\n    if (localToken) {\r\n      setToken(localToken);\r\n    }\r\n  }, []);\r\n\r\n  // Fetch cart when token is available\r\n  useEffect(() => {\r\n    if (token && backendUrl) {\r\n      getUserCart(token);\r\n    }\r\n  }, [token, backendUrl]);\r\n\r\n  const value = {\r\n    products,\r\n    currency,\r\n    delivery_fee,\r\n    search,\r\n    setSearch,\r\n    showSearch,\r\n    setShowSearch,\r\n    cartItems,\r\n    addToCart,\r\n    setCartItems,\r\n    getCartCount,\r\n    updateQuantity,\r\n    getTotalAmount,\r\n    navigate,\r\n    backendUrl,\r\n    loading,\r\n    token,\r\n    setToken,\r\n    \r\n  };\r\n\r\n  return (\r\n    // provide context to children components\r\n    <ShopContext.Provider value={value}>{props.children}</ShopContext.Provider>\r\n  );\r\n};"
        }
    ]
}