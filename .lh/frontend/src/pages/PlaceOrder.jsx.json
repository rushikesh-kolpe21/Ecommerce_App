{
    "sourceFile": "frontend/src/pages/PlaceOrder.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1769592311362,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1769592311362,
            "name": "Commit-0",
            "content": "import React, { useContext, useState } from \"react\";\r\nimport { Title } from \"../components/Title\";\r\nimport { CartTotal } from \"../components/CartTotal\";\r\nimport { assets } from \"../assets/assets\";\r\nimport { ShopContext } from \"../context/ShopContext\";\r\nimport axios from \"axios\";\r\nimport { toast } from \"react-toastify\";\r\n\r\nexport const PlaceOrder = () => {\r\n  const [method, setMethod] = useState(\"cod\");\r\n const {navigate,backendUrl, token, cartItems, setCartItems, getTotalAmount, delivery_fee, products} = useContext(ShopContext);\r\n\r\n\r\n  const [formData, setFormData] = useState({\r\n    firstName: \"\",\r\n    lastName: \"\",\r\n    email: \"\",\r\n    street: \"\",\r\n    city: \"\",\r\n    state: \"\",\r\n    zipCode: \"\",\r\n    country: \"\",\r\n    phone: \"\",\r\n  });\r\n\r\n  const onChangeHandler = (event) => {\r\n    const { name, value } = event.target;\r\n\r\n    setFormData((prevData) => ({ ...prevData, [name]: value }));\r\n  };\r\n\r\n\r\n  const onSubmitHandler = async (event) => {\r\n    event.preventDefault();\r\n    // Handle form submission logic here\r\n\r\n  try {\r\n    // Create an empty array to store final order items\r\n    const orderItems = [];\r\n\r\n    // Loop through each itemId in cartItems\r\n    for (let itemId in cartItems) {\r\n\r\n      // Get all sizes for the current item\r\n      const sizes = cartItems[itemId];\r\n\r\n      // Loop through each size for this item\r\n      for (let size in sizes) {\r\n\r\n        // Get quantity of the current item with this size\r\n        const quantity = sizes[size];\r\n\r\n        // Check if quantity is greater than 0\r\n        if (quantity > 0) {\r\n\r\n          // Find product details from products array using itemId\r\n          const product = products.find(p => p._id === itemId);\r\n\r\n          // Check if product exists\r\n          if (product) {\r\n\r\n            // Add product info, size, and quantity to orderItems array\r\n            orderItems.push({\r\n              ...product,     // copy all product details\r\n              size: size,     // add selected size\r\n              quantity: quantity // add item quantity\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Prepare order data to be sent to backend\r\n    const orderData = {\r\n      items: orderItems,\r\n   \r\n      address: JSON.stringify(formData),\r\n      PaymentMethod: method,\r\n      amount: getTotalAmount() + delivery_fee\r\n    };\r\n\r\n    //switching to respective payment method pages\r\n    switch (method) {\r\n      case \"cod\": {\r\n        const response = await axios.post(\r\n          backendUrl + \"/api/order/place-order-cod\",\r\n          orderData,\r\n          { headers: { authorization: token } }\r\n        );\r\n\r\n        if (response.data.success) {\r\n          setCartItems({});\r\n          navigate(\"/orders\");\r\n        } else {\r\n          console.error(\"Order placement failed:\", response.data.message);\r\n          toast.error(response.data.message || \"Order placement failed\");\r\n        }\r\n        break;\r\n      }\r\n\r\n      case \"stripe\": {\r\n        const stripeResponse = await axios.post(\r\n          backendUrl + \"/api/order/place-order-stripe\",\r\n          orderData,\r\n          { headers: { authorization: token } }\r\n        );\r\n\r\n        if (stripeResponse.data.success && stripeResponse.data.url) {\r\n          // redirecting to stripe checkout page\r\n          window.location.replace(stripeResponse.data.url);\r\n        } else {\r\n          const message = stripeResponse.data?.message || \"Order placement failed\";\r\n          toast.error(\"Order placement failed: \" + message);\r\n        }\r\n        break;\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Error processing order:\", error);\r\n    toast.error(error.response?.data?.message || error.message);  \r\n  }\r\n\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={onSubmitHandler} className=\"flex flex-col sm:flex-row justify-between gap-4 pt-5 sm:pt-14 min-h-[80vh] border-t\">\r\n      <div className=\"flex flex-col gap-4 w-full sm:max-w-[480px]\">\r\n        {/* ---------------------left side----------------- */}\r\n        <div className=\"text-xl sm:text-2xl my-3\">\r\n          <Title text1={\" DELIVERY\"} text2={\"INFORMATION\"} />\r\n        </div>\r\n        <div className=\"flex gap-3\">\r\n          <input\r\n            className=\"border border-gray-300 rounded py-1.5 px-3.5 w-full\"\r\n            type=\"text\"\r\n            placeholder=\"First Name\"\r\n            name=\"firstName\"\r\n            value={formData.firstName}\r\n            onChange={onChangeHandler}\r\n            required\r\n          />\r\n          <input\r\n            className=\"border border-gray-300 rounded py-1.5 px-3.5 w-full\"\r\n            type=\"text\"\r\n            placeholder=\"Last Name\"\r\n            name=\"lastName\"\r\n            value={formData.lastName}\r\n            onChange={onChangeHandler}\r\n            required\r\n          />\r\n        </div>\r\n        <input\r\n          className=\"border border-gray-300 rounded py-1.5 px-3.5 w-full\"\r\n          type=\"email\"\r\n          placeholder=\"Email address\"\r\n          name=\"email\"\r\n          value={formData.email}\r\n          onChange={onChangeHandler}\r\n          required\r\n        />\r\n        <input\r\n          className=\"border border-gray-300 rounded py-1.5 px-3.5 w-full\"\r\n          type=\"text\"\r\n          placeholder=\"Street\"\r\n          name=\"street\"\r\n          value={formData.street}\r\n          onChange={onChangeHandler}\r\n          required\r\n        />\r\n        <div className=\"flex gap-3\">\r\n          <input\r\n            className=\"border border-gray-300 rounded py-1.5 px-3.5 w-full\"\r\n            type=\"text\"\r\n            placeholder=\"City\"\r\n            name=\"city\"\r\n            value={formData.city}\r\n            onChange={onChangeHandler}\r\n            required\r\n          />\r\n          <input\r\n            className=\"border border-gray-300 rounded py-1.5 px-3.5 w-full\"\r\n            type=\"text\"\r\n            placeholder=\"State\"\r\n            name=\"state\"\r\n            value={formData.state}\r\n            onChange={onChangeHandler}\r\n            required\r\n          />\r\n        </div>\r\n        <div className=\"flex gap-3\">\r\n          <input\r\n            className=\"border border-gray-300 rounded py-1.5 px-3.5 w-full\"\r\n            type=\"number\"\r\n            placeholder=\"Zip Code\"\r\n            name=\"zipCode\"\r\n            value={formData.zipCode}\r\n            onChange={onChangeHandler}\r\n            required\r\n          />\r\n          <input\r\n            className=\"border border-gray-300 rounded py-1.5 px-3.5 w-full\"\r\n            type=\"text\"\r\n            placeholder=\"Country\"\r\n            name=\"country\"\r\n            value={formData.country}\r\n            onChange={onChangeHandler}\r\n            required\r\n          />\r\n        </div>\r\n        <input\r\n          className=\"border border-gray-300 rounded py-1.5 px-3.5 w-full\"\r\n          type=\"number\"\r\n          placeholder=\"Phone Number\"\r\n          name=\"phone\"\r\n          value={formData.phone}\r\n          onChange={onChangeHandler}\r\n          required  \r\n        />\r\n      </div>\r\n      {/* ------------------------------Right Side----------------------------- */}\r\n      <div className=\"mt-8\">\r\n        <div className=\"mt-8 min-w-80\">\r\n          <CartTotal />\r\n        </div>\r\n        <div className=\"mt-12\">\r\n          <Title text1={\" PAYMENT\"} text2={\"METHOD\"} />\r\n          {/* ---------------------Payment Method Selection */}\r\n          <div className=\"flex gap-3 flex-col lg:flex-row\">\r\n            <div\r\n              onClick={() => setMethod(\"stripe\")}\r\n              className=\"flex items-center gap-3 border p-2 px-3 cursor-pointer\"\r\n            >\r\n              <p\r\n                className={`min-w-3.5 h-3.5 border rounded-full ${method === \"stripe\" ? \"bg-green-400\" : \"\"}`}\r\n              ></p>\r\n              <img className=\"h-6 mx-4\" src={assets.stripe_logo} alt=\"\" />\r\n            </div>\r\n            <div\r\n              onClick={() => setMethod(\"razorpay\")}\r\n              className=\"flex items-center gap-3 border p-2 px-3 cursor-pointer\"\r\n            >\r\n              <p\r\n                className={`min-w-3.5 h-3.5 border rounded-full ${method === \"razorpay\" ? \"bg-green-400\" : \"\"}`}\r\n              ></p>\r\n              <img className=\"h-6 mx-4\" src={assets.razorpay_logo} alt=\"\" />\r\n            </div>\r\n            <div\r\n              onClick={() => setMethod(\"cod\")}\r\n              className=\"flex items-center gap-3 border p-2 px-3 cursor-pointer\"\r\n            >\r\n              <p\r\n                className={`min-w-3.5 h-3.5 border rounded-full ${method === \"cod\" ? \"bg-green-400\" : \"\"}`}\r\n              ></p>\r\n              <p className=\"text-sm text-gray-500 mx-4 font-semibold\">\r\n                {\" \"}\r\n                CASH ON DELIVERY\r\n              </p>\r\n            </div>\r\n          </div>\r\n          <div className=\"w-full text-end mt-8\">\r\n            <button\r\n            type=\"submit\"\r\n             \r\n              className=\"bg-black text-white px-16 py-3 text-sm\"\r\n            >\r\n              PLACE ORDER\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n"
        }
    ]
}