{
    "sourceFile": "Admin/src/pages/Orders.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1769589251384,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1769589251384,
            "name": "Commit-0",
            "content": "import React, { useEffect, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport { backendUrl, currency } from \"../App\";\r\nimport { assets } from \"../assets/assets\";\r\n\r\nexport const Orders = ({ token }) => {\r\n  const [ordersData, setOrdersData] = useState([]);\r\n\r\n  // fetch orders (silent on failure)\r\n  const fetchAllOrders = async () => {\r\n    if (!token) return;\r\n    try {\r\n      const res = await axios.get(backendUrl + \"/api/order/all-list\", {\r\n        headers: { token },\r\n      });\r\n      if (res.data?.success) setOrdersData(res.data.orders || []);\r\n    } catch {\r\n      /* silent */\r\n    }\r\n  };\r\n\r\n  const handleStatusChange = async (event, orderId) => {\r\n    try {\r\n      const response = await axios.post(\r\n        backendUrl + \"/api/order/update-status\",\r\n        { orderId, status: event.target.value },\r\n        { headers: { token } }\r\n      );\r\n\r\n      if(response.data.success){\r\n        await fetchAllOrders(); // refresh orders\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error updating order status:\", error);\r\n        toast.e\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchAllOrders();\r\n  }, [token]);\r\n\r\n  // helper: normalize items to lines like \"Product Name x 1 , M\"\r\n  const getProductLines = (items) => {\r\n    const lines = [];\r\n\r\n    // case 1: items is an array of { name, qty, size }\r\n    if (Array.isArray(items)) {\r\n      items.forEach((it) => {\r\n        const name = it.name || it.title || it.itemName || \"Product\";\r\n        const qty = it.qty ?? it.quantity ?? 1;\r\n        const size = it.size || it.variant || \"\";\r\n        lines.push(`${name} x ${qty}${size ? ` , ${size}` : \"\"}`);\r\n      });\r\n      return lines;\r\n    }\r\n\r\n    // case 2: items is an object like { itemName: { size: qty } }\r\n    if (items && typeof items === \"object\") {\r\n      Object.entries(items).forEach(([name, sizes]) => {\r\n        // sizes might be { M: 1, L: 2 } or could be a single number\r\n        if (typeof sizes === \"object\") {\r\n          Object.entries(sizes).forEach(([size, qty]) => {\r\n            lines.push(`${name} x ${qty}${size ? ` , ${size}` : \"\"}`);\r\n          });\r\n        } else {\r\n          // sizes is a number (qty)\r\n          lines.push(`${name} x ${sizes}`);\r\n        }\r\n      });\r\n    }\r\n\r\n    return lines;\r\n  };\r\n\r\n  \r\n\r\n  return (\r\n    <div className=\"px-6 py-6\">\r\n      {/* keep small title like image (optional) */}\r\n      <h3 className=\"text-sm text-gray-600 mb-4\">Order Page</h3>\r\n\r\n      <div className=\"space-y-4\">\r\n        {ordersData.map((order, idx) => {\r\n          // safe parse address (address might be stringified)\r\n          const address = typeof order.address === \"string\" ? (() => {\r\n            try { return JSON.parse(order.address); } catch { return {}; }\r\n          })() : (order.address || {});\r\n\r\n          const productLines = getProductLines(order.items);\r\n          const totalItems = productLines.reduce((sum, line) => {\r\n            const m = line.match(/x\\s*(\\d+)/);\r\n            return sum + (m ? Number(m[1]) : 0);\r\n          }, 0);\r\n\r\n          const fullAddress = [\r\n            address?.street,\r\n            address?.city,\r\n            address?.state,\r\n            address?.country,\r\n            address?.zipCode,\r\n          ].filter(Boolean).join(\", \");\r\n\r\n          const displayDate = new Date(order.date || Date.now()).toLocaleDateString(\"en-US\");\r\n\r\n          return (\r\n            <div\r\n              key={idx}\r\n              className=\"flex items-start gap-6 bg-white border border-gray-200 p-4 rounded\"\r\n            >\r\n              {/* icon */}\r\n              <div className=\"w-12 flex-shrink-0\">\r\n                <img src={assets.parcel_icon} alt=\"\" className=\"w-10 h-10 object-contain\" />\r\n              </div>\r\n\r\n              {/* Column 1: products, name, address, phone */}\r\n              <div className=\"flex-1 text-sm text-gray-800\">\r\n                {productLines.map((line, i) => (\r\n                  <p key={i} className=\"leading-5\">\r\n                    {line}\r\n                  </p>\r\n                ))}\r\n\r\n                <p className=\"mt-3 font-semibold\">\r\n                  {address?.firstName || \"\"} {address?.lastName || \"\"}\r\n                </p>\r\n                <p className=\"mt-1 text-gray-600\">{fullAddress}</p>\r\n                <p className=\"mt-1 text-gray-600\">{address?.phone || \"\"}</p>\r\n              </div>\r\n\r\n              {/* Column 2: Items / Method / Payment / Date */}\r\n              <div className=\"w-48 text-sm text-gray-700\">\r\n                <p>Items : {totalItems}</p>\r\n                <p>Method : {order.method || \"COD\"}</p>\r\n                <p>Payment : {order.payment ? \"Paid\" : \"Pending\"}</p>\r\n                <p>Date : {displayDate}</p>\r\n              </div>\r\n\r\n              {/* Column 3: Price */}\r\n              <div className=\"w-28 text-sm font-semibold\">\r\n                <p>\r\n                  {currency}\r\n                  {order.amount}\r\n                </p>\r\n              </div>\r\n\r\n              {/* Column 4: Status */}\r\n              <div className=\"w-48\">\r\n                <select\r\n                  value={order.status || \"Order Placed\"}\r\n                  onChange={(e) => handleStatusChange(event, order._id)}\r\n                  className=\"w-full border rounded px-2 py-1 text-sm bg-white\"\r\n                >\r\n                  <option>Order Placed</option>\r\n                  <option>Packing</option>\r\n                  <option>Shipped</option>\r\n                  <option>Out for delivery</option>\r\n                  <option>Delivered</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n          );\r\n        })} \r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n"
        }
    ]
}